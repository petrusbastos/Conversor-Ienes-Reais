<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Conversor Iene → Real (Modo Viagem)</title>
  <style>
    :root { color-scheme: light dark; }
    body {
      font-family: -apple-system, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: calc(16px + env(safe-area-inset-top)) 16px calc(16px + env(safe-area-inset-bottom));
      line-height: 1.25;
    }
    .card {
      max-width: 560px;
      margin: 0 auto;
      padding: 16px;
      border-radius: 18px;
      border: 1px solid rgba(120,120,120,.35);
    }
    h1 { font-size: 22px; margin: 0 0 8px; }
    .muted { opacity: .75; font-size: 14px; margin-bottom: 14px; }
    .rate {
      display:flex; align-items:center; justify-content:space-between;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(120,120,120,.12);
      margin-bottom: 14px;
      font-size: 14px;
    }
    .rate b { font-size: 15px; }
    label { display: block; font-weight: 800; margin: 12px 0 8px; font-size: 16px; }

    input[type="number"]{
      width: 100%;
      padding: 16px 14px;
      font-size: 24px;
      font-weight: 800;
      border-radius: 16px;
      border: 1px solid rgba(120,120,120,.45);
      outline: none;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 12px;
    }
    .grid2 {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 10px;
    }

    button {
      padding: 14px 10px;
      font-size: 16px;
      font-weight: 700;
      border-radius: 16px;
      border: 1px solid rgba(120,120,120,.45);
      background: transparent;
      -webkit-tap-highlight-color: transparent;
    }
    button:active { transform: scale(0.99); }

    .result {
      margin-top: 14px;
      padding: 14px 14px;
      border-radius: 16px;
      background: rgba(120,120,120,.12);
    }
    .big {
      font-size: 34px;
      font-weight: 900;
      letter-spacing: -0.3px;
    }
    .small { font-size: 14px; opacity: .8; margin-top: 6px; }
    .hint { font-size: 13px; opacity: .75; margin-top: 10px; }

    .row-inline {
      display:flex; gap:10px; margin-top: 10px;
    }
    .row-inline button { flex: 1; }

    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size: 12px; opacity: .8; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Conversor Iene → Real</h1>
    <div class="muted">Modo viagem (uso rápido, fonte grande).</div>

    <div class="rate" aria-label="Taxa usada">
      <span>Taxa efetiva (já com IOF):</span>
      <b id="rateLabel"></b>
    </div>

    <label for="yen">Ienes (JPY)</label>
    <input id="yen" type="number" inputmode="numeric" pattern="[0-9]*"
           placeholder="Ex: 700" min="0" step="1" />

    <div class="grid" aria-label="Atalhos de valores comuns">
      <button type="button" data-set="100">¥ 100</button>
      <button type="button" data-set="500">¥ 500</button>
      <button type="button" data-set="1000">¥ 1.000</button>
      <button type="button" data-set="2000">¥ 2.000</button>
      <button type="button" data-set="5000">¥ 5.000</button>
      <button type="button" data-set="10000">¥ 10.000</button>
    </div>

    <div class="grid2" aria-label="Somar rapidamente">
      <button type="button" data-add="100">+ ¥ 100</button>
      <button type="button" data-add="500">+ ¥ 500</button>
      <button type="button" data-add="1000">+ ¥ 1.000</button>
      <button type="button" id="btnClear">Limpar</button>
    </div>

    <div class="result" aria-live="polite">
      <div class="big" id="brl">R$ 0,00</div>
      <div class="small" id="detail">Digite um valor em ienes.</div>
      <div class="small kbd" id="formula"></div>
    </div>

    <div class="row-inline">
      <button id="btnCopy" type="button">Copiar</button>
      <button id="btnShare" type="button">Compartilhar</button>
    </div>

    <div class="hint">
      Dica: você pode abrir com valor pré-preenchido usando <span class="kbd">?yen=700</span>.
    </div>
  </div>

  <script>
    // Taxa efetiva informada (já inclui IOF)
    const RATE = 0.0383; // R$ por iene

    const yenEl = document.getElementById("yen");
    const brlEl = document.getElementById("brl");
    const detailEl = document.getElementById("detail");
    const formulaEl = document.getElementById("formula");
    const rateLabel = document.getElementById("rateLabel");
    const btnClear = document.getElementById("btnClear");
    const btnCopy = document.getElementById("btnCopy");
    const btnShare = document.getElementById("btnShare");

    rateLabel.textContent = `R$ ${RATE.toFixed(4).replace(".", ",")} / ¥ 1`;

    function formatBRL(v) {
      return v.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
    }

    function compute() {
      const yenStr = yenEl.value;
      const yen = Number(yenStr || 0);

      if (!yenStr) {
        brlEl.textContent = "R$ 0,00";
        detailEl.textContent = "Digite um valor em ienes.";
        formulaEl.textContent = "";
        return;
      }

      const brl = yen * RATE;
      brlEl.textContent = formatBRL(brl);
      detailEl.textContent = `${yen.toLocaleString("pt-BR")} ienes x R$ ${RATE.toFixed(4).replace(".", ",")}`;
      formulaEl.textContent = `Fórmula: ${yen} x ${RATE}`;
    }

    // Input
    yenEl.addEventListener("input", compute);

    // Set / Add buttons
    document.querySelectorAll("button[data-set]").forEach(btn => {
      btn.addEventListener("click", () => {
        yenEl.value = btn.getAttribute("data-set");
        compute();
        yenEl.focus();
      });
    });

    document.querySelectorAll("button[data-add]").forEach(btn => {
      btn.addEventListener("click", () => {
        const add = Number(btn.getAttribute("data-add"));
        const cur = Number(yenEl.value || 0);
        yenEl.value = String(cur + add);
        compute();
        yenEl.focus();
      });
    });

    btnClear.addEventListener("click", () => {
      yenEl.value = "";
      compute();
      yenEl.focus();
    });

    // Copy
    btnCopy.addEventListener("click", async () => {
      const yen = Number(yenEl.value || 0);
      const brl = brlEl.textContent;
      const text = `${yen} ienes → ${brl} (taxa efetiva: ${RATE})`;
      try {
        await navigator.clipboard.writeText(text);
        detailEl.textContent = "Copiado para a área de transferência.";
      } catch (e) {
        detailEl.textContent = "Não foi possível copiar automaticamente.";
      }
    });

    // Share (iOS Safari supports navigator.share in many cases)
    btnShare.addEventListener("click", async () => {
      const yen = Number(yenEl.value || 0);
      const brl = brlEl.textContent;
      const text = `${yen} ienes → ${brl} (taxa efetiva: ${RATE})`;
      if (navigator.share) {
        try {
          await navigator.share({ title: "Conversão Iene → Real", text });
        } catch (e) { /* user canceled */ }
      } else {
        // fallback to copy
        try { await navigator.clipboard.writeText(text); } catch (e) {}
        detailEl.textContent = "Compartilhamento não disponível. Resultado copiado.";
      }
    });

    // Prefill from URL: ?yen=700
    const params = new URLSearchParams(location.search);
    const yenParam = params.get("yen");
    if (yenParam) {
      yenEl.value = yenParam.replace(/[^0-9]/g, "");
    }
    compute();
  </script>
</body>
</html>
